Transform: AWS::Serverless-2016-10-31

Parameters:
  AccountId:
    Type: String

Resources:
  JwksRsaCustomAuthorizer:
    Type: AWS::Serverless::Function
    Properties:
      PackageType: Image
      ImageUri: !If
        - IsLocalEnvironment
        - authorizer-fn:latest
        - !Sub "${AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/authorizer-fn:dev-v1"
      ImageConfig:
        Command: ["dist/index.handler"]
    Metadata:
      Dockerfile: Dockerfile
      DockerTarget: authorizer
      DockerContext: ../..

Outputs:
  JwksRsaCustomAuthorizerArn:
    Description: "ARN of the Custom Authorizer Function"
    Value: !GetAtt [JwksRsaCustomAuthorizer, Arn]
    Export:
      Name: !Sub "${AWS::StackName}-JwksRsaCustomAuthorizerArn"

Conditions:
  IsLocalEnvironment: !Equals [!Ref Environment, local]
